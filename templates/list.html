{% extends "index.html" %}

{% block head %}
  <title>상품 조회 | 이화 마켓</title>
  <!-- list 전용 CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='list.css') }}">
{% endblock head %}

{% block section %}
<div class="container">

  <!-- 리뷰와 동일한 상단 라인 구조/클래스 -->
  <div class="first_line">
    <label id="items_all">상품 조회 | {{ products|length }}개</label>

    <form class="search_group" method="get" action="{{ url_for('view_list') }}">
      <label for="search">검색 | </label>
      <input
        id="search"
        type="search"
        name="q"
        placeholder="검색어를 입력하세요"
        value="{{ request.args.get('q','') }}"
        aria-label="검색어"
      />
      <button class="search__btn" type="submit" aria-label="검색">⌕</button>
    </form>

    <a id="latest">최신순</a>
  </div>

  <!-- 상품 카드 그리드 -->
  <div class="review_container">
    {% if products %}
      {% for p in products %}
        <article class="review_set" data-pid="{{ p.id }}">
          <label class="review_title" title="{{ p.name }}">
            <span class="review_title__name">{{ p.name }}</span>

            <form method="post"
                  action="{{ url_for('toggle_wish', pid=p.id) }}"
                  style="display:inline;">
              <button
                class="card__heart{% if p.liked %} is-liked{% endif %}"
                type="submit"
                aria-label="찜하기">
                {{ '♥' if p.liked else '♡' }}
              </button>
            </form>
          </label>

          <a class="review_link" href="{{ url_for('product_detail', pid=p.id) }}"><!--  이미지 감싸는 링크 클래스 통일 -->
            {% if p.thumb %}
              <img
                src="{{ url_for('static', filename=p.thumb) }}"
                alt="{{ p.name }}">
            {% else %}
              <div class="card__image card__image--empty">이미지 없음</div>
            {% endif %}
          </a>
        </article>
      {% endfor %}
    {% else %}
      <p class="empty">등록된 상품이 없습니다.</p>
    {% endif %}
  </div>

    <!-- 페이지 네비게이션 (백엔드 연동 버전) -->
  <nav class="pagination" aria-label="페이지네비게이션">
    {# 이전 버튼 #}
    {% if page > 1 %}
      <a class="page-btn"
        href="{{ url_for('view_list',
                          page=page-1,
                          q=request.args.get('q', '') ) }}">
        〈 이전
      </a>
    {% else %}
      <span class="page-btn">〈 이전</span>
    {% endif %}

    {# 페이지 번호들 #}
    {% for p in range(1, page_count + 1) %}
      {% if p == page %}
        <span class="page is-active">{{ p }}</span>
      {% else %}
        <a class="page"
          href="{{ url_for('view_list',
                            page=p,
                            q=request.args.get('q', '') ) }}">
          {{ p }}
        </a>
      {% endif %}
    {% endfor %}

    {# 다음 버튼 #}
    {% if page < page_count %}
      <a class="page-btn"
        href="{{ url_for('view_list',
                          page=page+1,
                          q=request.args.get('q', '') ) }}">
        다음 〉
      </a>
    {% else %}
      <span class="page-btn">다음 〉</span>
    {% endif %}
  </nav>

</div>

{% endblock section %}
